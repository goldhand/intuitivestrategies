{% extends "layouts/blog_layout.html" %}
{% load i18n mezzanine_tags blog_tags keyword_tags disqus_tags %}

{% block center %}

{% if author %}
<div class="span6">
{% else %}
<div class="span8">
{% endif %}

{% if tag or category or year or month or author %}
    <p>
    {% if tag %}
        {% trans "Viewing posts tagged" %} {{ tag }}
    {% else %}{% if category %}
        {% trans "Viewing posts for the category" %} {{ category }}
    {% else %}{% if year or month %}
        {% trans "Viewing posts from" %} {% if month %}{{ month }}, {% endif %}
        {{ year }}
    {% else %}{% if author %}
        {% trans "Viewing posts by" %}
        {{ author.get_full_name|default:author.username }}
    {% endif %}{% endif %}{% endif %}{% endif %}
    </p>
{% else %}
    {% if page %}
    {% editable page.richtextpage.content %}
<!--    {{ page.richtextpage.content|safe }} -->
    {% endeditable %}
    {% endif %}
{% endif %}


{% for blog_post in blog_posts.object_list %}
{% editable blog_post.title blog_post.publish_date %}
<h2>
    <a href="{{ blog_post.get_absolute_url }}">{{ blog_post.title }}</a>
</h2>
<h6>


    {% with blog_post.user as author %}

    <a href="{% url blog_post_list_author author %}"><img class="pull-left userprofile" src="{{ MEDIA_URL }}{{ author.userprofile.thumbnail }}" /></a>
    
    <a href="{% url blog_post_list_author author %}">{{ author.get_full_name|default:author.username }}</a>
    {% endwith %}<br/>
    {% if blog_post.category_list %}
    {% trans "in" %}
    {% for category in blog_post.category_list %}
    <a href="{% url blog_post_list_category category.slug %}">{{ category }}</a><br/>
    {% endfor %}
    {% endif %}
    {{ blog_post.publish_date|timesince }} {% trans "ago" %}
</h6>
{% endeditable %}
<div class="row"></div>
{% if blog_post.featured_image %}
<img class="featured-thumb" src="{{ MEDIA_URL }}{% thumbnail blog_post.featured_image 90 90 %}">
{% endif %}

{% editable blog_post.content %}
{{ blog_post.description_from_content|safe }}
{% endeditable %}

<p class="blog-list-detail">
    {% if blog_post.keyword_list %}
    {% trans "Tags" %}:
    {% spaceless %}
    {% for tag in blog_post.keyword_list %}
    <a href="{% url blog_post_list_tag tag.slug %}" class="tag">{{ tag }}</a>
    {% endfor %}
    {% endspaceless %}
    <br>
    {% endif %}
    <a href="{{ blog_post.get_absolute_url }}">{% trans "read more" %}</a>
    /
    {% if settings.COMMENTS_DISQUS_SHORTNAME %}
    <a href="{{ blog_post.get_absolute_url }}#disqus_thread"
        data-disqus-identifier="{% disqus_id_for blog_post %}">
        {% trans "Comments" %}
    </a>
    {% else %}
    <a href="{{ blog_post.get_absolute_url }}#comments">
        {% blocktrans count blog_post.comments_count as comments_count %}1 comment{% plural %}{{ comments_count }} comments{% endblocktrans %}
    </a>
    {% endif %}
</p>
{% endfor %}

{% pagination_for blog_posts %}

{% if settings.COMMENTS_DISQUS_SHORTNAME %}
{% include "generic/includes/disqus_counts.html" %}
{% endif %}
</div>

{% endblock %}
{% block right_panel %}


{% if author %}
<div class="span4">
<div class="userprofile">
<h3>{{ author.userprofile.name }}</h4>
<h4>{% for group in author.groups.all %}{{ group|upper }}{% if not forloop.last %}, {% endif %}{% endfor %}</h4>
<img class="pull-left" src="{{ MEDIA_URL }}{{ author.userprofile.image }}" />
<ul class="unstyled">
<li>Title:</li>
<li>Email: {{ author.email }}
<li>Member Since: {{ author.date_joined }}</li>
</ul>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec cursus, massa vel blandit gravida, dolor est interdum lorem, hendrerit porttitor tellus sapien fringilla ante. Nam eget volutpat velit. Vivamus id ante eget nunc ornare iaculis ut eu tortor. Curabitur ornare eros pharetra turpis ullamcorper nec ornare eros consectetur. Suspendisse sapien est, venenatis at ornare non, mollis nec nunc. Vivamus at condimentum mauris. Nam aliquet dui congue odio posuere sed bibendum diam accumsan. Proin at velit neque, vel vestibulum felis. Suspendisse vehicula tempor fringilla. Fusce malesuada consequat leo ut auctor.</p>
<h3>Recent Posts by {{ author.userprofile.name }}</h3>
<ul class="unstyled">
{% for blog_post in author.blogposts.all %}
<li><a href="{{ blog_post.get_absolute_url }}">{{ blog_post.title }}</a></li>
{% endfor %}
</ul>
</div>
{% else %}
<div class="span2">
{% include "blog/includes/filter_panel.html" %}
{% endif %}
</div>
</div>
{% endblock %}


